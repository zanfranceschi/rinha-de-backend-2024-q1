CREATE TABLE IF NOT EXISTS "customer" (
  "id" SMALLINT NOT NULL,
  "limit" NUMERIC(15,0) NOT NULL,
  "balance" NUMERIC(15,0) NOT NULL,
  CONSTRAINT "PK_CUSTOMER" PRIMARY KEY ("id")
);

CREATE TABLE IF NOT EXISTS "transaction" (
  "id" INT4 NOT NULL GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE),
  "customer_id" SMALLINT NOT NULL,
  "value" NUMERIC(15,0) NOT NULL,
  "type" CHAR(1) NOT NULL,
  "description" VARCHAR(10),
  "datetime" TIMESTAMPTZ NOT NULL,
  CONSTRAINT "PK_TRANSACTION" PRIMARY KEY ("id"),
  CONSTRAINT "FK_TRANSACTION_CUSTOMER" FOREIGN KEY ("customer_id") REFERENCES "customer"("id")
);

CREATE INDEX CONCURRENTLY IF NOT EXISTS transaction_customer_id_datetime_idx ON "transaction" ("customer_id" ASC, "datetime" DESC);

INSERT INTO "customer" ("id", "limit", "balance") 
VALUES 
  (1, 100000, 0),
  (2, 80000, 0),
  (3, 1000000, 0),
  (4, 10000000, 0),
  (5, 500000, 0);
